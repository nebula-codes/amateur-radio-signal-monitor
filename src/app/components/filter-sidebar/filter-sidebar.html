<mat-card class="filter-card">
  <mat-card-header>
    <mat-card-title>Signal Filters</mat-card-title>
  </mat-card-header>
  
  <mat-card-content>
    <form [formGroup]="filterForm" class="filter-form">
      
      <!-- Mode Selection -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Operating Modes</mat-label>
        <mat-select formControlName="modes" multiple>
          <mat-option *ngFor="let mode of availableModes" [value]="mode">
            {{ mode }}
          </mat-option>
        </mat-select>
        <mat-hint>Select one or more operating modes</mat-hint>
      </mat-form-field>

      <!-- Selected Modes Chips -->
      <div class="chip-container" *ngIf="filterForm.get('modes')?.value?.length > 0">
        <mat-chip-set>
          <mat-chip *ngFor="let mode of filterForm.get('modes')?.value" 
                    (removed)="removeSelectedItem('modes', mode)"
                    removable>
            {{ mode }}
            <mat-icon matChipRemove>cancel</mat-icon>
          </mat-chip>
        </mat-chip-set>
      </div>

      <!-- Band Selection -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Amateur Radio Bands</mat-label>
        <mat-select formControlName="bands" multiple>
          <mat-option *ngFor="let band of availableBands" [value]="band">
            {{ band }}
          </mat-option>
        </mat-select>
        <mat-hint>Select one or more bands</mat-hint>
      </mat-form-field>

      <!-- Selected Bands Chips -->
      <div class="chip-container" *ngIf="filterForm.get('bands')?.value?.length > 0">
        <mat-chip-set>
          <mat-chip *ngFor="let band of filterForm.get('bands')?.value" 
                    (removed)="removeSelectedItem('bands', band)"
                    removable>
            {{ band }}
            <mat-icon matChipRemove>cancel</mat-icon>
          </mat-chip>
        </mat-chip-set>
      </div>

      <!-- Country Selection -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Countries</mat-label>
        <mat-select formControlName="countries" multiple>
          <mat-option *ngFor="let country of availableCountries" [value]="country">
            {{ country }}
          </mat-option>
        </mat-select>
        <mat-hint>Select one or more countries</mat-hint>
      </mat-form-field>

      <!-- Selected Countries Chips -->
      <div class="chip-container" *ngIf="filterForm.get('countries')?.value?.length > 0">
        <mat-chip-set>
          <mat-chip *ngFor="let country of filterForm.get('countries')?.value" 
                    (removed)="removeSelectedItem('countries', country)"
                    removable>
            {{ country }}
            <mat-icon matChipRemove>cancel</mat-icon>
          </mat-chip>
        </mat-chip-set>
      </div>

      <!-- Call Sign Selection -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Call Signs</mat-label>
        <mat-select formControlName="callSigns" multiple>
          <mat-option *ngFor="let callSign of availableCallSigns" [value]="callSign">
            {{ callSign }}
          </mat-option>
        </mat-select>
        <mat-hint>Select one or more call signs</mat-hint>
      </mat-form-field>

      <!-- Selected Call Signs Chips -->
      <div class="chip-container" *ngIf="filterForm.get('callSigns')?.value?.length > 0">
        <mat-chip-set>
          <mat-chip *ngFor="let callSign of filterForm.get('callSigns')?.value" 
                    (removed)="removeSelectedItem('callSigns', callSign)"
                    removable>
            {{ callSign }}
            <mat-icon matChipRemove>cancel</mat-icon>
          </mat-chip>
        </mat-chip-set>
      </div>

      <!-- Date/Time Filters -->
      <div class="date-time-section">
        <h4>Date/Time Range</h4>
        
        <div class="date-time-row">
          <mat-form-field appearance="outline" class="date-field">
            <mat-label>Start Date</mat-label>
            <input matInput [matDatepicker]="startPicker" formControlName="startDate">
            <mat-hint>Select start date</mat-hint>
            <mat-datepicker-toggle matIconSuffix [for]="startPicker"></mat-datepicker-toggle>
            <mat-datepicker #startPicker></mat-datepicker>
          </mat-form-field>

          <mat-form-field appearance="outline" class="time-field">
            <mat-label>Start Time</mat-label>
            <input matInput 
                   type="text" 
                   formControlName="startTime"
                   pattern="^([0-1]?[0-9]|2[0-3]):[0-5][0-9](:[0-5][0-9])?$"
                   placeholder="14:30:45"
                   maxlength="8"
                   (input)="onTimeInput($event, 'startTime')"
                   (blur)="onTimeBlur('startTime')">
            <mat-hint>24-hour format</mat-hint>
            <mat-error *ngIf="filterForm.get('startTime')?.hasError('pattern')">
              Please use 24-hour format
            </mat-error>
          </mat-form-field>
        </div>

        <div class="date-time-row">
          <mat-form-field appearance="outline" class="date-field">
            <mat-label>End Date</mat-label>
            <input matInput [matDatepicker]="endPicker" formControlName="endDate">
            <mat-hint>Select end date</mat-hint>
            <mat-datepicker-toggle matIconSuffix [for]="endPicker"></mat-datepicker-toggle>
            <mat-datepicker #endPicker></mat-datepicker>
          </mat-form-field>

          <mat-form-field appearance="outline" class="time-field">
            <mat-label>End Time</mat-label>
            <input matInput 
                   type="text" 
                   formControlName="endTime"
                   pattern="^([0-1]?[0-9]|2[0-3]):[0-5][0-9](:[0-5][0-9])?$"
                   placeholder="23:59:59"
                   maxlength="8"
                   (input)="onTimeInput($event, 'endTime')"
                   (blur)="onTimeBlur('endTime')">
            <mat-hint>24-hour format</mat-hint>
            <mat-error *ngIf="filterForm.get('endTime')?.hasError('pattern')">
              Please use 24-hour format
            </mat-error>
          </mat-form-field>
        </div>
      </div>

      <!-- Frequency Range -->
      <div class="range-section">
        <h4>Frequency Range (MHz)</h4>
        <div class="range-row">
          <mat-form-field appearance="outline" class="range-field">
            <mat-label>Min Frequency</mat-label>
            <input matInput type="number" step="0.001" formControlName="frequencyMin" placeholder="14.000">
            <mat-hint>Minimum frequency</mat-hint>
          </mat-form-field>

          <mat-form-field appearance="outline" class="range-field">
            <mat-label>Max Frequency</mat-label>
            <input matInput type="number" step="0.001" formControlName="frequencyMax" placeholder="14.350">
            <mat-hint>Maximum frequency</mat-hint>
          </mat-form-field>
        </div>
      </div>

      <!-- Signal Strength Range -->
      <div class="range-section">
        <h4>Signal Strength Range (dB)</h4>
        <div class="range-row">
          <mat-form-field appearance="outline" class="range-field">
            <mat-label>Min Signal Strength</mat-label>
            <input matInput type="number" formControlName="signalStrengthMin" placeholder="-120">
            <mat-hint>Minimum signal strength</mat-hint>
          </mat-form-field>

          <mat-form-field appearance="outline" class="range-field">
            <mat-label>Max Signal Strength</mat-label>
            <input matInput type="number" formControlName="signalStrengthMax" placeholder="0">
            <mat-hint>Maximum signal strength</mat-hint>
          </mat-form-field>
        </div>
      </div>

    </form>
  </mat-card-content>

  <mat-card-actions class="filter-actions">
    <button mat-raised-button color="primary" (click)="applyFilters()">
      <mat-icon>filter_list</mat-icon>
      Apply Filters
    </button>
    <button mat-stroked-button (click)="clearFilters()">
      <mat-icon>clear</mat-icon>
      Clear All
    </button>
  </mat-card-actions>
</mat-card>
